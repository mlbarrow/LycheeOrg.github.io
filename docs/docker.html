<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Lychee Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <link rel="canonical" href="https://lycheeorg.github.io/docs/">

    <!-- Favicon -->
    <!-- <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png"> -->
    <link rel="icon" type="image/png" href="/assets/images/logo.png">
    <!-- <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png"> -->
    <!-- <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png"> -->
    <!-- <link rel="manifest" href="/img/favicon/site.webmanifest"> -->
    <!-- <link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#ff2d20"> -->
    <!-- <link rel="shortcut icon" href="/img/favicon/favicon.ico"> -->
    <meta name="msapplication-TileColor" content="#ff2d20">
    <!-- <meta name="msapplication-config" content="/img/favicon/browserconfig.xml"> -->
    <meta name="theme-color" content="#ffffff">

    <!-- Load styles -->
    <link rel="stylesheet" type="text/css" href="css/app.css">
    <link rel="stylesheet" type="text/css" href="css/prism.css">

    <!-- Load JS -->
    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/prism.js"></script>

</head>

<body>

    <div class="sidebar_layout" id="docsScreen">

        <div class="page_contain">
            <div class="contain">
                <aside class="sidebar">
                    <a href="../" class="logo">
                        <img class="mark" src="/assets/images/logo.png" alt="Laravel">
                        <img class="type" src="img/Lychee.png" alt="Laravel">
                    </a>
                    <nav>
                        <div class="navigation_contain">
                            <div class="docs_sidebar">
                                <ul>
                                    <li class='sub--on'>
<h2>Prologue</h2>
<ul>
<li><a href='org.html'>Lychee & LycheeOrg</a></li>
<li><a href='releases.html'>Release Notes</a></li>
</ul>
<li class='sub--on'>
<h2>Getting Started</h2>
<ul>
<li><a href='installation.html'>Installation</a></li>
<li><a href='configuration.html'>Configuration</a></li>
<li class='active'><a href='docker.html'>Docker</a></li>
<li><a href='update.html'>Update</a></li>
<li><a href='upgrade.html'>Upgrade from v3</a></li>
</ul>
<li class='sub--on'>
<h2>Advanced Topics</h2>
<ul>
<li><a href='settings.html'>Settings</a></li>
<li><a href='keyboard.html'>Keyboard Shortcuts</a></li>
<li><a href='advanced-setups.html'>Advanced Setups</a></li>
<li><a href='honeypot.html'>Honeypot and Teapots</a></li>
<li><a href='external_tracking.html'>External tracking with Matomo,<br>Google Analytics & Co</a></li>
</ul>
<li class='sub--on'>
<h2>Frequently Asked Question</h2>
<ul>
<li><a href='faq_general.html'>General</a></li>
<li><a href='faq_installation.html'>Installation, migration, upgrade, update</a></li>
<li><a href='faq_troubleshooting.html'>Troubleshooting</a></li>
</ul>
<li class='sub--on'>
<h2>Contributing</h2>
<ul>
<li><a href='contributions.html'>Contribution Guide</a></li>
<li><a href='api.html'>API Documentation</a></li>
<li><a href='architecture.html'>Lychee logic overview</a></li>
<li><a href='structure.html'>Directory Structure</a></li>
<li><a href='frontend.html'>Front-end</a></li>
<li><a href='livewire.html'>Livewire Front-end (alpha)</a></li>
</ul>

                                    <li class="laravel">
                                        <a href="https://laravel.com/docs/8.x"><h2>Laravel<img style="margin-left:4px;" src="img/external-link.svg" /></h2></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                    <div class="trigger_contain">
                        <a href="#" class="nav_trigger" aria-label="Menu">
                            <div class="bar"></div>
                        </a>
                    </div>
                </aside>

                <section class="body_content">
                    <section class="docs_body">
                        <section class="docs_main">
                            <h1>Docker</h1>
                            
<ul>
<li><a href="#image-content">Image Content</a></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#run-with-docker">Run with Docker</a></li>
<li><a href="#run-with-docker-compose">Run with Docker Compose</a></li>
</ul>
</li>
<li><a href="#available-environment-variables-and-defaults">Available environment variables and defaults</a></li>
<li><a href="#advanced-configuration">Advanced configuration</a></li>
</ul>

                            <hr> <h2 id="image-content"><a class="toclink" href="#image-content">Image Content</a></h2>
<p>This image features Lychee, nginx and PHP-FPM. The provided configuration (PHP, nginx...) follows Lychee's official recommendations.</p>
<p>The following tags are available:</p>
<ul>
<li><code>latest</code>: Latest Lychee release</li>
<li><code>v[NUMBER]</code>: Stable version tag for a Lychee release</li>
<li><code>dev</code>: Current master branch tag (Lychee operates on a stable master, so this should usually be safe)</li>
<li><code>testing</code>: Tag for testing new branches and pull requests. Designed for internal use by LycheeOrg.</li>
</ul>
<p>Note that only the <code>:dev</code> tag is available for armv6 and armv7 systems. This is due to an issue with the build environment and is hopefully temporary.</p>
<h2 id="setup"><a class="toclink" href="#setup">Setup</a></h2>
<h3 id="quick-start"><a class="toclink" href="#quick-start">Quick Start</a></h3>
<p>To use the built-in SQLite support, no external dependencies are required. At its simplest, <code>docker run -p 80 lycheeorg/lychee:dev</code> will start Lychee listening on a random port on the local host.</p>
<p>For more runtime options, look below in <a href="#run-with-docker">Run with Docker</a> and <a href="#available-environment-variables-and-defaults">Available environment variables and defaults</a>.</p>
<h3 id="prerequisites"><a class="toclink" href="#prerequisites">Prerequisites</a></h3>
<p>To use this image with MySQL, MariaDB or PostgreSQL you will need a suitable database running externally. This may be through a Docker image, possibly in your <code>docker-compose.yml</code>.</p>
<ol>
<li>Create the DB, username, password.</li>
<li>Edit the environment variables (db credentials, language...) by :<ul>
<li>Supplying the environment variables via <code>docker run</code> / <code>docker-compose</code> <strong>or</strong></li>
<li>Creating a <code>.env</code> file with the appropriate info and mount it to <code>/conf/.env</code> <strong>or</strong></li>
<li>Use the Lychee installer by passing <code>-e DB_CONNECTION=</code> on the command line and connecting to the container with your browser</li>
</ul>
</li>
</ol>
<h3 id="run-with-docker"><a class="toclink" href="#run-with-docker">Run with Docker</a></h3>
<p><strong>Make sure that you link to the container running your database !!</strong>  </p>
<p>The example below shows <code>--net</code> and <code>--link</code> for these purposes. <code>--net</code> connects to the name of the network your database is on and  <code>--link</code> connects to the database container.</p>
<pre><code class="language-bash">docker run -d \
--name=lychee \
-v /host_path/lychee/conf:/conf \
-v /host_path/lychee/uploads:/uploads \
-v /host_path/lychee/sym:/sym \
-e PUID=1000 \
-e PGID=1000 \
-e PHP_TZ=America/New_York \
-e DB_CONNECTION=mysql \
-e DB_HOST=mariadb \
-e DB_PORT=3306 \
-e DB_DATABASE=lychee \
-e DB_USERNAME=user \
-e DB_PASSWORD=password \
-p 90:80 \
--net network_name \
--link db_name \
lycheeorg/lychee
</code></pre>
<p><strong>Warning</strong> : if you use a MySQL database, make sure to use the <code>mysql_native_password</code> authentication plugin, either by using the <code>--default-authentication-plugin</code> option when starting mysql, or by running a query to enable the authentication plugin for the <code>lychee</code> user, e.g. :</p>
<pre><code class="language-sql">alter user 'lychee' identified with mysql_native_password by '&lt;your password&gt;';
</code></pre>
<h3 id="run-with-docker-compose"><a class="toclink" href="#run-with-docker-compose">Run with Docker Compose</a></h3>
<p>Change the environment variables in the <a href="https://github.com/LycheeOrg/Lychee-Docker/blob/master/docker-compose.yml">provided example</a> to reflect your database credentials.</p>
<p>Note that in order to avoid writing credentials directly into the file, you can create a <code>db_secrets.env</code> and use the <code>env_file</code> directive (see the <a href="https://docs.docker.com/compose/environment-variables/#the-env_file-configuration-option">docs</a>).</p>
<h2 id="available-environment-variables-and-defaults"><a class="toclink" href="#available-environment-variables-and-defaults">Available environment variables and defaults</a></h2>
<p>If you do not provide environment variables or <code>.env</code> file, the <a href="https://github.com/LycheeOrg/Lychee/blob/master/.env.example">example .env file</a> will be used with some values already set by default.</p>
<p>Some variables are specific to Docker, and the default values are :</p>
<ul>
<li><code>PUID=1000</code></li>
<li><code>PGID=1000</code></li>
<li><code>USER=lychee</code></li>
<li><code>PHP_TZ=UTC</code></li>
<li><code>STARTUP_DELAY=0</code></li>
</ul>
<h2 id="advanced-configuration"><a class="toclink" href="#advanced-configuration">Advanced configuration</a></h2>
<p>Note that nginx will accept by default images up to 100MB (<code>client_max_body_size 100M</code>) and that PHP parameters are overridden according to the <a href="https://lycheeorg.github.io/docs/faq_troubleshooting.html#i-cant-upload-large-photos">recommendations of the Lychee FAQ</a>.</p>
<p>You may still want to further customize PHP configuration. The first method is to mount a custom <code>php.ini</code> to <code>/etc/php/7.4/fpm/php.ini</code> when starting the container. However, this method is kind of brutal as it will override all parameters. It will also need to be remapped whenever an image is released with a new version of PHP.</p>
<p>Instead, we recommend to use the <code>PHP_VALUE</code> directive of PHP-FPM to override specific parameters. To do so, you will need to mount a custom <code>nginx.conf</code> in your container :</p>
<ol>
<li>Take the <a href="https://github.com/LycheeOrg/Lychee-Docker/blob/master/default.conf">default.conf</a> file as a base</li>
<li>Find the line starting by <code>fastcgi_param PHP_VALUE [...]</code></li>
<li>Add a new line and set your new parameter</li>
<li>Add or change any other parameters (e.g. <code>client_max_body_size</code>)</li>
<li>Mount your new file to <code>/etc/nginx/nginx.conf</code></li>
</ol><blockquote><p>{tip} Caught a mistake or want to contribute to the documentation?&nbsp;<a href="https://github.com/LycheeOrg/LycheeOrg.github.io/tree/master/docs/docker.md">Edit this page on Github!</a></p></blockquote>
                        </section>
                    </section>
                </section>
            </div>
        </div>

    </div>
</body>
<script src="js/app.js"></script>

</html>
